\section{Operations Initiated by Central Management System}

\subsection{Change Station Operation State}

\marginlabel{Description:}
\acs{CMS} can request to change the operation state of a \acs{PS} or its slots. The \acs{PS} can accept or reject the process the request. When rejected, the \acs{PS} must include a reason.

\marginlabel{URL:}

\marginlabel{Method:} POST

\marginlabel{Request:} 
JSON object with following elements as parameters:\\
\begin{tabularx}{\linewidth}{ | l | X | }
  \hline
  \textit{Field} & \textit{Description} \\
  \hline \hline
  slotId (optional) 		& When present, the state of the slot with the given ID will be changed. When absent, the state of whole \acs{PS} will be changed. \\
  state 					& See Section \ref{types:OperationState} \\
    \hline
\end{tabularx}

\marginlabel{Response:} \textbf{200 OK}

\marginlabel{Errors:}
JSON object with following elements:\\
\begin{tabularx}{\linewidth}{ | l | X | }
  \hline
  \textit{Field} & \textit{Description} \\
  \hline \hline
  code 			& See Section \ref{types:errors} \\
  reason 		& Reasoning why the request was rejected. \\
    \hline
\end{tabularx}

\subsection{Change Pedelec Operation State}

\marginlabel{Description:}
\acs{CMS} can request to change the operation state of a pedelec located at a slot of a \acs{PS}. The \acs{PS} can accept or reject the process the request. When rejected, the \acs{PS} must include a reason.

\marginlabel{URL:}

\marginlabel{Method:} POST

\marginlabel{Request:} 
JSON object with following elements as parameters:\\
\begin{tabularx}{\linewidth}{ | l | X | }
  \hline
  \textit{Field} & \textit{Description} \\
  \hline \hline
  slotId			& The ID of the slot where the pedelec is located. \\
  pedelecId		& The ID of the pedelec. \\
  state 			& See Section \ref{types:OperationState} \\
  \hline
\end{tabularx}

\marginlabel{Response:} \textbf{200 OK}

\marginlabel{Errors:}
JSON object with following elements:\\
\begin{tabularx}{\linewidth}{ | l | X | }
  \hline
  \textit{Field} & \textit{Description} \\
  \hline \hline
  code 			& See Section \ref{types:errors} \\
  reason 		& Reasoning why the request was rejected. \\
  \hline
\end{tabularx}

\subsection{Change Configuration}

\marginlabel{Description:}
\acs{CMS} can request a \acs{PS} to change configuration parameters. This request contains a list of key-value pairs, where "key" is the name of the configuration setting to change and "value" contains the new setting for the configuration setting.

\marginlabel{URL:}

\marginlabel{Method:} POST

\marginlabel{Request:} 
JSON object with following elements as parameters:\\
\begin{tabularx}{\linewidth}{ | l | l | X | }
  \hline
  \textit{Field} & \textit{Value} &\textit{Description} \\
  \hline \hline
  CentralSystemURL 			& string 		& New value for the URL \\
  HeartBeatInterval 			& integer 		& In seconds \\
  OpenSlotTimeout 			& integer 		& In seconds. How long should \acs{PS} wait after unlocking a slot before locking it again. \\
  ConnectionTimeOut 			& integer 		& In seconds \\
  RebootRetries 				& integer 		& How many times should \acs{PS} try to reboot before giving up.\\
  ChargeStateInformInterval 	& integer 		& In seconds \\
  \hline
\end{tabularx}

\marginlabel{Response:} 
\textbf{200 OK}\\ If all the parameter changes are accepted and done.

\marginlabel{Errors:}
JSON object with following elements:\\
\begin{tabularx}{\linewidth}{ | l | l | X | }
  \hline
  \textit{Field} & \textit{Value} & \textit{Description} \\
  \hline \hline
  failed			& JSON array & List of parameters that \acs{PS} failed to set a new value for.\\
  reason 		& Not Acceptable, Not Found & Reasoning why the request was rejected.\\
  \hline
\end{tabularx}

\textit{Not Acceptable:} If the request for some keys could not be processed. It returns a JSON array of keys that are rejected (in this case other parameters are set)

\textit{Not Found:} If some of the keys are not found/supported. It returns a JSON array of keys that are not found as configuration parameters (in this case other parameters are set)

\subsection{Get Configuration}

\acs{CMS} can retrieve the values of configuration settings. This operation requires no parameters, and \acs{PS} returns all values.

\seealso{Section \ref{types:ConfigurationKeyValue}} See Section \ref{types:ConfigurationKeyValue} for returned configuration parameters.

\subsection{Remote Authorize}

When using the mobile app for renting a pedelec the user does not require a card to authenticate against the \acs{PS}, but uses the app to authenticate directly against the \acs{CMS}. In this case, \acs{CMS} sends a Remote Authorize message to the \acs{PS} to unlock the slot(s) for the user to take the pedelec. 

After a timeout period \acs{PS} checks the existence of a pedelec at the slot(s) and sends a Start Transaction message to \acs{CMS}, namely the rental process proceeds usual.

\subsection{Cancel Authorize}

When using the mobile app for renting a pedelec the user can wish to cancel the rental process after Remote Authorize is initiated. In this case, \acs{CMS} sends a Cancel Authorize message to the \acs{PS} lock the slot(s) again.

\subsection{Reboot}

\acs{CMS} can request a \acs{PS} to reboot. The \acs{PS} must respond with "Accepted" or "Rejected". When accepted, the \acs{PS} reboots after gracefully terminating running software. When rejected, the \acs{PS} must include a reason.

\subsection{Unlock Slot}

In cases of maintenance or technical problems \acs{CMS} can request a \acs{PS} to unlock a slot in order to access a pedelec.

\subsection{Get Charge State}

Even though a \acs{PS} informs the \acs{CMS} about the charging state of pedelecs regularly, it is desirable to get the latest information in various cases.